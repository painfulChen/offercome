<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <title>用户体验测试 - OfferCome</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles-mobile-optimized.css">
    <script src="js/mobile-performance.js"></script>
</head>
<body>
    <div class="mobile-container">
        <div class="mobile-card">
            <h1 style="font-size: 24px; margin-bottom: 20px;">用户体验测试</h1>
            
            <div id="performance-metrics" class="mobile-card" style="background: #f8fafc; margin-bottom: 20px;">
                <h3>性能指标</h3>
                <div id="metrics-content">
                    <p>正在收集性能数据...</p>
                </div>
            </div>
            
            <div class="mobile-card">
                <h3>功能测试</h3>
                <button class="mobile-btn" onclick="testAPI()">
                    <i class="fas fa-wifi"></i>
                    测试API连接
                </button>
                
                <button class="mobile-btn" onclick="testCache()">
                    <i class="fas fa-database"></i>
                    测试缓存功能
                </button>
                
                <button class="mobile-btn" onclick="testNetwork()">
                    <i class="fas fa-signal"></i>
                    测试网络优化
                </button>
                
                <button class="mobile-btn" onclick="testErrorHandling()">
                    <i class="fas fa-exclamation-triangle"></i>
                    测试错误处理
                </button>
            </div>
            
            <div class="mobile-card">
                <h3>移动端优化</h3>
                <div class="mobile-answer-options">
                    <button class="mobile-answer-btn touch-target">
                        <span class="option-text">触摸目标测试 (44px最小)</span>
                        <i class="fas fa-check"></i>
                    </button>
                    
                    <button class="mobile-answer-btn touch-target">
                        <span class="option-text">硬件加速测试</span>
                        <i class="fas fa-rocket"></i>
                    </button>
                    
                    <button class="mobile-answer-btn touch-target">
                        <span class="option-text">防抖节流测试</span>
                        <i class="fas fa-clock"></i>
                    </button>
                </div>
            </div>
            
            <div id="test-results" class="mobile-card" style="display: none;">
                <h3>测试结果</h3>
                <div id="results-content"></div>
            </div>
        </div>
    </div>

    <script>
        class UXTestSuite {
            constructor() {
                this.results = {};
                this.init();
            }
            
            async init() {
                // 等待性能数据收集
                setTimeout(() => {
                    this.updatePerformanceMetrics();
                }, 2000);
            }
            
            updatePerformanceMetrics() {
                const metrics = MobileOptimizer.performance.getPerformanceMetrics();
                const metricsContent = document.getElementById('metrics-content');
                
                metricsContent.innerHTML = `
                    <div style="text-align: left; font-size: 14px;">
                        <p><strong>LCP (Largest Contentful Paint):</strong> ${metrics.largestContentfulPaint.toFixed(2)}ms</p>
                        <p><strong>CLS (Cumulative Layout Shift):</strong> ${metrics.cumulativeLayoutShift.toFixed(4)}</p>
                        <p><strong>缓存条目数:</strong> ${MobileOptimizer.cache.cache.size}</p>
                        <p><strong>错误数量:</strong> ${MobileOptimizer.error.getErrors().length}</p>
                        <p><strong>网络类型:</strong> ${navigator.connection?.effectiveType || 'unknown'}</p>
                    </div>
                `;
            }
            
            async testAPI() {
                try {
                    const startTime = performance.now();
                    const response = await fetch('https://offercome2025-9g14jitp22f4ddfc-1256790827.ap-shanghai.app.tcloudbase.com/api-v2/health');
                    const endTime = performance.now();
                    
                    const data = await response.json();
                    const duration = endTime - startTime;
                    
                    this.addResult('API连接测试', {
                        status: 'success',
                        message: `API响应正常，耗时 ${duration.toFixed(2)}ms`,
                        data: data
                    });
                } catch (error) {
                    this.addResult('API连接测试', {
                        status: 'error',
                        message: `API连接失败: ${error.message}`
                    });
                }
            }
            
            testCache() {
                // 测试缓存功能
                const testKey = 'test-cache-key';
                const testValue = { message: '缓存测试数据', timestamp: Date.now() };
                
                MobileOptimizer.cache.set(testKey, testValue, 60000); // 1分钟过期
                const retrieved = MobileOptimizer.cache.get(testKey);
                
                if (retrieved && retrieved.message === testValue.message) {
                    this.addResult('缓存功能测试', {
                        status: 'success',
                        message: '缓存功能正常，数据存储和检索成功'
                    });
                } else {
                    this.addResult('缓存功能测试', {
                        status: 'error',
                        message: '缓存功能异常，数据存储或检索失败'
                    });
                }
            }
            
            testNetwork() {
                const connection = navigator.connection;
                const networkInfo = {
                    effectiveType: connection?.effectiveType || 'unknown',
                    downlink: connection?.downlink || 'unknown',
                    rtt: connection?.rtt || 'unknown',
                    saveData: connection?.saveData || false
                };
                
                this.addResult('网络优化测试', {
                    status: 'success',
                    message: '网络状态检测完成',
                    data: networkInfo
                });
            }
            
            testErrorHandling() {
                // 模拟错误
                try {
                    throw new Error('测试错误');
                } catch (error) {
                    MobileOptimizer.error.logError('Test Error', {
                        message: error.message,
                        test: true
                    });
                    
                    this.addResult('错误处理测试', {
                        status: 'success',
                        message: '错误处理机制正常，错误已记录'
                    });
                }
            }
            
            addResult(testName, result) {
                this.results[testName] = result;
                this.updateResults();
            }
            
            updateResults() {
                const resultsContainer = document.getElementById('test-results');
                const resultsContent = document.getElementById('results-content');
                
                resultsContainer.style.display = 'block';
                
                let html = '';
                for (const [testName, result] of Object.entries(this.results)) {
                    const statusClass = result.status === 'success' ? 'mobile-success' : 'mobile-error';
                    html += `
                        <div class="${statusClass}">
                            <h4>${testName}</h4>
                            <p>${result.message}</p>
                            ${result.data ? `<pre style="font-size: 12px; margin-top: 10px;">${JSON.stringify(result.data, null, 2)}</pre>` : ''}
                        </div>
                    `;
                }
                
                resultsContent.innerHTML = html;
            }
        }
        
        // 初始化测试套件
        const uxTest = new UXTestSuite();
        
        // 全局测试函数
        function testAPI() {
            uxTest.testAPI();
        }
        
        function testCache() {
            uxTest.testCache();
        }
        
        function testNetwork() {
            uxTest.testNetwork();
        }
        
        function testErrorHandling() {
            uxTest.testErrorHandling();
        }
        
        // 触摸测试
        document.querySelectorAll('.mobile-answer-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.classList.add('selected');
                setTimeout(() => {
                    this.classList.remove('selected');
                }, 300);
            });
        });
        
        // 性能监控
        window.addEventListener('load', () => {
            setTimeout(() => {
                uxTest.updatePerformanceMetrics();
            }, 1000);
        });
    </script>
</body>
</html> 