# OfferCome 当前架构分析

## 🏗️ 已有服务

### ✅ 腾讯云CloudBase服务
- **云函数**: 运行Node.js后端API
- **静态网站托管**: 部署前端页面
- **HTTP触发器**: 提供API接口
- **环境**: 已配置开发/生产环境

### ✅ 腾讯云服务器 (SVM)
- **用途**: 应用服务器/数据库服务器
- **系统**: Linux (Ubuntu/CentOS)
- **网络**: 公网IP，可访问外网
- **存储**: 本地存储空间

---

## 📊 服务架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端用户      │    │   CloudBase     │    │   腾讯云服务器   │
│                │    │                │    │                │
│ 微信小程序      │◄──►│ 静态网站托管     │    │ 应用服务器      │
│ H5页面         │    │ 云函数API       │    │ 数据库服务器    │
│ 管理后台       │    │ HTTP触发器      │    │ 监控服务        │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                        │
                                ▼                        ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │  腾讯云TDSQL-C  │    │   本地MySQL     │
                       │                │    │                │
                       │ 云数据库        │    │ 本地数据库      │
                       │ 高可用          │    │ 开发测试        │
                       │ 自动备份        │    │ 数据迁移        │
                       └─────────────────┘    └─────────────────┘
```

---

## 🎯 推荐订阅方案

### 方案一：云数据库 + 云服务器 (推荐)

#### 需要订阅的服务：
1. **腾讯云TDSQL-C** (必需)
   - 用途：生产环境数据库
   - 规格：2核4GB (开发) / 4核8GB (生产)
   - 成本：约200-800元/月
   - 优势：高可用、自动备份、监控

2. **腾讯云CVM** (已有)
   - 用途：应用服务器
   - 规格：2核4GB (开发) / 4核8GB (生产)
   - 成本：约100-400元/月
   - 优势：稳定可靠、易于管理

#### 架构优势：
- ✅ 云数据库高可用
- ✅ 自动备份恢复
- ✅ 专业监控告警
- ✅ 弹性扩展
- ✅ 安全防护

### 方案二：混合架构 (经济型)

#### 服务配置：
1. **腾讯云TDSQL-C** (生产环境)
   - 用途：生产数据库
   - 规格：2核4GB
   - 成本：约200元/月

2. **腾讯云服务器** (开发环境)
   - 用途：开发测试数据库
   - 规格：本地MySQL
   - 成本：0元 (已有服务器)

#### 架构优势：
- ✅ 生产环境高可用
- ✅ 开发环境零成本
- ✅ 数据迁移方便
- ✅ 成本可控

---

## 💰 成本分析

### 当前已有服务成本：
- **CloudBase**: 按量付费，约50-100元/月
- **腾讯云服务器**: 已有，约100-400元/月

### 需要订阅的服务成本：

#### 方案一：完整云架构
```
服务名称          规格              月成本
腾讯云TDSQL-C     2核4GB 20GB      200元
腾讯云TDSQL-C     4核8GB 100GB     800元 (生产)
腾讯云CVM         2核4GB           100元
腾讯云CVM         4核8GB           400元 (生产)
CloudBase         按量付费          50-100元
总计:             开发环境          350-700元/月
总计:             生产环境          1250-1300元/月
```

#### 方案二：混合架构
```
服务名称          规格              月成本
腾讯云TDSQL-C     2核4GB 20GB      200元 (生产)
腾讯云服务器      已有              0元 (开发)
CloudBase         按量付费          50-100元
总计:             开发环境          50-100元/月
总计:             生产环境          250-300元/月
```

---

## 🚀 推荐订阅步骤

### 第一步：订阅腾讯云TDSQL-C

#### 1. 访问腾讯云控制台
```
https://console.cloud.tencent.com/tdsql
```

#### 2. 创建TDSQL-C实例
```
地域: 选择离用户最近的地域
规格: 2核4GB (开发环境)
存储: 20GB SSD
密码: Offercome2024!
```

#### 3. 配置网络
```
安全组: 开放3306端口
白名单: 添加CloudBase和服务器IP
```

### 第二步：配置数据库连接

#### 1. 获取连接信息
```
在控制台获取:
- 内网地址: tdsql-xxxxx.tencentcloudapi.com
- 外网地址: tdsql-xxxxx.tencentcloudapi.com
- 端口: 3306
```

#### 2. 创建数据库用户
```
用户名: offercome_user
密码: Offercome2024!
权限: 读写权限
```

#### 3. 使用脚本配置
```bash
# 配置数据库连接
./tencent-cloud-setup.sh configure \
  --host tdsql-xxxxx.tencentcloudapi.com \
  --username offercome_user \
  --password Offercome2024! \
  --database offercome
```

### 第三步：初始化数据库

#### 1. 初始化数据库结构
```bash
# 初始化数据库
./tencent-cloud-setup.sh init \
  --host tdsql-xxxxx.tencentcloudapi.com \
  --username offercome_user \
  --password Offercome2024! \
  --database offercome
```

#### 2. 测试连接
```bash
# 测试数据库连接
./tencent-cloud-setup.sh test \
  --host tdsql-xxxxx.tencentcloudapi.com \
  --username offercome_user \
  --password Offercome2024! \
  --database offercome
```

### 第四步：更新应用配置

#### 1. 更新CloudBase环境变量
```bash
# 在CloudBase控制台设置环境变量
DB_HOST=tdsql-xxxxx.tencentcloudapi.com
DB_PORT=3306
DB_USER=offercome_user
DB_PASSWORD=Offercome2024!
DB_NAME=offercome
```

#### 2. 重新部署云函数
```bash
# 重新部署API
tcb framework deploy
```

---

## 🔧 配置检查清单

### CloudBase配置
- [ ] 云函数已部署
- [ ] HTTP触发器已配置
- [ ] 环境变量已设置
- [ ] 静态网站已部署

### 腾讯云服务器配置
- [ ] 服务器正常运行
- [ ] 网络连接正常
- [ ] 安全组已配置
- [ ] 监控已开启

### 腾讯云TDSQL-C配置
- [ ] 实例已创建
- [ ] 数据库用户已创建
- [ ] 网络白名单已配置
- [ ] 连接测试通过
- [ ] 数据库结构已初始化

---

## 📞 技术支持

### 腾讯云支持
- **技术支持**: 400-9100-100
- **在线工单**: https://console.cloud.tencent.com/workorder
- **文档中心**: https://cloud.tencent.com/document

### 常见问题
1. **连接超时**: 检查网络和安全组配置
2. **权限错误**: 确认数据库用户权限
3. **SSL错误**: 更新SSL配置
4. **性能问题**: 检查实例规格和索引

---

## 🎉 总结

### 当前状态：
- ✅ CloudBase服务：已配置
- ✅ 腾讯云服务器：已有
- ⏳ 腾讯云TDSQL-C：需要订阅

### 推荐方案：
**方案二：混合架构** (经济型)
- 开发环境：使用服务器本地MySQL (0成本)
- 生产环境：使用腾讯云TDSQL-C (200元/月)
- 总成本：约250-300元/月

### 下一步：
1. 订阅腾讯云TDSQL-C
2. 配置数据库连接
3. 初始化数据库结构
4. 测试应用连接
5. 部署到生产环境

你现在只需要订阅腾讯云TDSQL-C数据库服务即可完成完整的云架构部署！ 