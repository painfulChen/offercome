# 📱 腾讯云短信服务配置指南

## 🎯 配置步骤

### 1. 注册腾讯云账号
1. 访问 [腾讯云官网](https://cloud.tencent.com/)
2. 注册/登录腾讯云账号
3. 完成实名认证

### 2. 开通短信服务
1. 进入 [短信服务控制台](https://console.cloud.tencent.com/sms)
2. 点击"立即开通"
3. 选择"国内短信"
4. 完成开通

### 3. 创建应用
1. 在短信服务控制台，点击"应用管理"
2. 点击"创建应用"
3. 填写应用名称：`OfferCome`
4. 选择"通用"类型
5. 创建完成后，记录 `SDK AppID`

### 4. 创建签名
1. 在短信服务控制台，点击"国内短信" → "签名管理"
2. 点击"创建签名"
3. 填写签名信息：
   - **签名内容**: `OfferCome`
   - **签名类型**: 选择"公司"或"个人"
   - **签名用途**: 选择"验证码"
   - **证明类型**: 上传相关证明文件
4. 等待审核通过（通常1-2个工作日）

### 5. 创建模板
1. 在短信服务控制台，点击"国内短信" → "模板管理"
2. 点击"创建模板"
3. 填写模板信息：
   - **模板名称**: `验证码模板`
   - **模板类型**: 选择"验证码"
   - **模板内容**: `您的OfferCome验证码是：{1}，5分钟内有效，请勿泄露给他人。`
   - **申请说明**: 用于用户注册和登录验证
4. 等待审核通过（通常1-2个工作日）

### 6. 获取API密钥
1. 在腾讯云控制台，点击右上角头像
2. 选择"访问管理" → "API密钥管理"
3. 点击"新建密钥"
4. 记录 `SecretId` 和 `SecretKey`

## 🔧 环境变量配置

### 创建环境变量文件
```bash
# 复制示例文件
cp env.sms.example .env

# 编辑环境变量
nano .env
```

### 配置环境变量
```bash
# 腾讯云短信配置
TENCENT_SECRET_ID=your_secret_id_here
TENCENT_SECRET_KEY=your_secret_key_here
SMS_SDK_APP_ID=your_sdk_app_id_here
SMS_SIGN_NAME=OfferCome
SMS_TEMPLATE_ID=your_template_id_here

# 短信服务密钥
SMS_SECRET=your_sms_secret_key_here

# 特殊手机号列表（会收到真实短信）
REAL_SMS_PHONES=17356511434,13800138000,18600000000
```

## 📋 配置参数说明

| 参数名 | 说明 | 获取位置 |
|--------|------|----------|
| `TENCENT_SECRET_ID` | 腾讯云API密钥ID | 访问管理 → API密钥管理 |
| `TENCENT_SECRET_KEY` | 腾讯云API密钥Key | 访问管理 → API密钥管理 |
| `SMS_SDK_APP_ID` | 短信应用ID | 短信服务 → 应用管理 |
| `SMS_SIGN_NAME` | 短信签名 | 短信服务 → 签名管理 |
| `SMS_TEMPLATE_ID` | 短信模板ID | 短信服务 → 模板管理 |

## 💰 费用说明

### 短信费用
- **国内短信**: 0.05元/条
- **国际短信**: 0.5元/条
- **免费额度**: 新用户通常有100条免费额度

### 计费规则
- 按实际发送条数计费
- 发送失败不计费
- 支持按量付费

## 🚀 部署配置

### 1. 本地测试
```bash
# 加载环境变量
source .env

# 测试短信发送
node -e "
const smsService = require('./server/services/smsService');
smsService.sendRealSMS('17356511434', '123456').then(console.log);
"
```

### 2. 云函数部署
```bash
# 部署到CloudBase
tcb fn deploy api -e offercome2025-9g14jitp22f4ddfc --dir server --force
```

### 3. 环境变量设置
在CloudBase控制台设置环境变量：
1. 进入云函数管理
2. 选择 `api` 函数
3. 点击"环境变量"
4. 添加所有必要的环境变量

## ✅ 测试验证

### 1. 配置测试
```bash
# 运行配置测试
./test-real-sms.sh
```

### 2. 功能测试
1. 访问手机认证页面
2. 输入手机号：`17356511434`
3. 点击发送验证码
4. 检查是否收到真实短信

### 3. 日志查看
```bash
# 查看云函数日志
tcb fn logs api -e offercome2025-9g14jitp22f4ddfc
```

## 🔒 安全注意事项

### 1. 密钥安全
- 不要将密钥提交到代码仓库
- 使用环境变量存储敏感信息
- 定期轮换API密钥

### 2. 短信安全
- 设置发送频率限制
- 监控异常发送行为
- 定期检查发送日志

### 3. 验证码安全
- 设置合理的过期时间
- 限制验证码尝试次数
- 防止暴力破解

## 🎉 配置完成

配置完成后，您的OfferCome平台将支持：
- ✅ **真实短信发送**: 通过腾讯云短信服务
- ✅ **验证码验证**: 安全的验证码机制
- ✅ **用户注册**: 手机号+验证码注册
- ✅ **用户登录**: 多种登录方式
- ✅ **安全防护**: 完善的安全机制

## 📞 技术支持

如果遇到问题，可以：
1. 查看腾讯云短信服务文档
2. 检查环境变量配置
3. 查看云函数日志
4. 联系技术支持

---

**注意**: 请确保所有配置信息正确，特别是签名和模板需要审核通过才能正常使用。 