# 🏗️ OfferCome智能求职辅导平台 - 系统架构图

## 📋 系统概述

OfferCome是一个基于腾讯云CloudBase的智能求职辅导平台，集成了AI服务、MBTI人格测试、RAG文档管理、用户认证、案例管理等功能。

## 🎯 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           OfferCome智能求职辅导平台                              │
└─────────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    │               │               │
            ┌───────▼───────┐ ┌─────▼─────┐ ┌──────▼──────┐
            │   前端层      │ │   API层   │ │   数据层    │
            │  Frontend     │ │   API     │ │   Data      │
            └───────────────┘ └───────────┘ └─────────────┘
                    │               │               │
            ┌───────▼───────┐ ┌─────▼─────┐ ┌──────▼──────┐
            │ 微信小程序    │ │  CloudBase │ │  MongoDB    │
            │  Web管理端    │ │  云函数    │ │   Redis     │
            │  静态托管     │ │  HTTP触发器│ │   MySQL     │
            └───────────────┘ └───────────┘ └─────────────┘
```

## 🏛️ 详细架构图

### 1. 前端层 (Frontend Layer)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               前端层 (Frontend Layer)                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   微信小程序    │  │   Web管理端     │  │   静态托管      │                │
│  │  Miniprogram    │  │  Admin Panel    │  │  Static Hosting  │                │
│  │                 │  │                 │  │                 │                │
│  │ • 用户登录      │  │ • 案例管理      │  │ • MBTI测试      │                │
│  │ • MBTI测试      │  │ • 用户管理      │  │ • 简历上传      │                │
│  │ • AI聊天        │  │ • 数据统计      │  │ • 文档管理      │                │
│  │ • 简历管理      │  │ • 系统监控      │  │ • 搜索功能      │                │
│  │ • 进度跟踪      │  │ • 成本监控      │  │ • 响应式设计    │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2. API层 (API Layer)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               API层 (API Layer)                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   认证服务      │  │   AI服务        │  │   RAG服务       │                │
│  │  Auth Service   │  │  AI Service     │  │  RAG Service    │                │
│  │                 │  │                 │  │                 │                │
│  │ • JWT认证       │  │ • Kimi AI       │  │ • 文档上传      │                │
│  │ • 用户注册      │  │ • OpenAI        │  │ • 文档搜索      │                │
│  │ • 用户登录      │  │ • 成本追踪      │  │ • 向量存储      │                │
│  │ • 权限管理      │  │ • 错误处理      │  │ • 分组管理      │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│           │                     │                     │                        │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   MBTI服务      │  │   案例服务      │  │   短信服务      │                │
│  │  MBTI Service   │  │  Case Service   │  │  SMS Service    │                │
│  │                 │  │                 │  │                 │                │
│  │ • 问题获取      │  │ • 案例CRUD      │  │ • 腾讯云SMS     │                │
│  │ • 答案提交      │  │ • 分类管理      │  │ • 阿里云SMS     │                │
│  │ • 类型计算      │  │ • 搜索功能      │  │ • 验证码发送    │                │
│  │ • 结果返回      │  │ • 数据导出      │  │ • 状态跟踪      │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 3. 服务层 (Service Layer)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             服务层 (Service Layer)                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                            RAG管理器 (RAG Manager)                         │ │
│  │                                                                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │   学生RAG       │  │   模块RAG       │  │   组合RAG       │            │ │
│  │  │ Student RAG     │  │ Module RAG      │  │ Combined RAG    │            │ │
│  │  │                 │  │                 │  │                 │            │ │
│  │  │ • 学生文档管理  │  │ • 模块文档管理  │  │ • 学生+模块     │            │ │
│  │  │ • 个性化搜索    │  │ • 专业知识库    │  │ • 精确分组      │            │ │
│  │  │ • 进度跟踪      │  │ • 跨学生共享    │  │ • 学习进度      │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                            AI服务管理器 (AI Manager)                       │ │
│  │                                                                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │   Kimi AI       │  │   OpenAI        │  │   模拟AI        │            │ │
│  │  │                 │  │                 │  │                 │            │ │
│  │  │ • 主要AI服务    │  │ • 备用AI服务    │  │ • 测试模式      │            │ │
│  │  │ • 成本优化      │  │ • 错误降级      │  │ • 离线支持      │            │ │
│  │  │ • 响应快速      │  │ • 高可靠性      │  │ • 开发调试      │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           业务服务管理器 (Business Manager)                 │ │
│  │                                                                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐            │ │
│  │  │   用户服务      │  │   案例服务      │  │   短信服务      │            │ │
│  │  │ User Service    │  │ Case Service    │  │ SMS Service     │            │ │
│  │  │                 │  │                 │  │                 │            │ │
│  │  │ • 用户管理      │  │ • 案例管理      │  │ • 短信发送      │            │ │
│  │  │ • 认证授权      │  │ • 分类管理      │  │ • 验证码        │            │ │
│  │  │ • 权限控制      │  │ • 搜索统计      │  │ • 状态跟踪      │            │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘            │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 4. 数据层 (Data Layer)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              数据层 (Data Layer)                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   MongoDB       │  │    Redis        │  │    MySQL        │                │
│  │   (主数据库)     │  │   (缓存)        │  │   (关系数据)    │                │
│  │                 │  │                 │  │                 │                │
│  │ • RAG文档       │  │ • 会话缓存      │  │ • 用户信息      │                │
│  │ • 向量存储      │  │ • 搜索结果      │  │ • 案例数据      │                │
│  │ • 系统日志      │  │ • 临时数据      │  │ • 统计数据      │                │
│  │ • 配置信息      │  │ • 状态信息      │  │ • 关系数据      │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 5. 部署层 (Deployment Layer)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            部署层 (Deployment Layer)                           │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                │
│  │   腾讯云        │  │   本地开发      │  │   测试环境      │                │
│  │  CloudBase      │  │  Local Dev      │  │  Test Env       │                │
│  │                 │  │                 │  │                 │                │
│  │ • 云函数        │  │ • Node.js       │  │ • 单元测试      │                │
│  │ • 静态托管      │  │ • MongoDB       │  │ • 集成测试      │                │
│  │ • HTTP触发器    │  │ • Redis         │  │ • 性能测试      │                │
│  │ • 自动扩缩容    │  │ • 热重载        │  │ • 压力测试      │                │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔄 数据流程图

### 1. 用户请求流程

```
用户请求 → 前端层 → API网关 → 云函数 → 服务层 → 数据层 → 响应返回
    │         │         │         │         │         │
    │         │         │         │         │         └── 数据库操作
    │         │         │         │         └── 业务逻辑处理
    │         │         │         └── 路由分发
    │         │         └── 请求验证
    │         └── 界面渲染
    └── 用户交互
```

### 2. RAG文档处理流程

```
文档上传 → 文件处理 → 内容提取 → 向量化 → 存储 → 索引更新
    │         │         │         │         │         │
    │         │         │         │         │         └── 搜索优化
    │         │         │         │         └── 数据库保存
    │         │         │         └── AI向量生成
    │         │         └── 文本内容提取
    │         └── 格式验证
    └── 用户选择分组
```

### 3. AI服务调用流程

```
用户查询 → 查询预处理 → AI服务选择 → API调用 → 响应处理 → 结果返回
    │         │         │         │         │         │
    │         │         │         │         │         └── 格式化输出
    │         │         │         │         └── 错误处理
    │         │         │         └── 成本追踪
    │         │         └── 负载均衡
    │         └── 参数验证
    └── 用户输入
```

## 📊 系统组件关系图

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           OfferCome系统组件关系图                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  前端层 (Frontend)                    API层 (API)                   数据层 (Data) │
│  ┌─────────────┐                    ┌─────────────┐                ┌─────────────┐ │
│  │ 微信小程序  │◄──────────────────►│ 认证服务    │◄──────────────►│ MongoDB     │ │
│  │ Web管理端   │                    │ AI服务      │                │ Redis       │ │
│  │ 静态托管    │                    │ RAG服务     │                │ MySQL       │ │
│  └─────────────┘                    │ MBTI服务    │                └─────────────┘ │
│                                     │ 案例服务    │                                │
│                                     │ 短信服务    │                                │
│                                     └─────────────┘                                │
│                                                                                 │
│  服务层 (Service)                                                               │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │  RAG管理器  │  AI管理器  │  业务管理器  │  数据管理器  │  监控管理器  │ │
│  │             │           │             │             │             │ │
│  │ • 学生RAG  │ • Kimi AI │ • 用户服务  │ • 连接池    │ • 性能监控  │ │
│  │ • 模块RAG  │ • OpenAI  │ • 案例服务  │ • 缓存管理  │ • 错误追踪  │ │
│  │ • 组合RAG  │ • 模拟AI  │ • 短信服务  │ • 事务管理  │ • 日志记录  │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🎯 核心功能模块

### 1. 用户认证模块
- **JWT认证**：安全的用户身份验证
- **权限管理**：基于角色的访问控制
- **会话管理**：用户会话状态维护

### 2. AI服务模块
- **多AI提供商**：Kimi、OpenAI、模拟模式
- **成本控制**：实时API调用成本追踪
- **错误处理**：优雅降级和重试机制

### 3. RAG文档管理模块
- **分组管理**：按学生、模块、组合分组
- **向量搜索**：基于相似度的智能检索
- **文档处理**：多格式文档支持

### 4. MBTI测试模块
- **问题管理**：4个核心维度的测试
- **结果计算**：16种人格类型分析
- **结果展示**：详细的类型描述

### 5. 案例管理模块
- **CRUD操作**：完整的案例增删改查
- **分类管理**：多维度案例分类
- **搜索功能**：关键词和标签搜索

### 6. 短信服务模块
- **多提供商**：腾讯云、阿里云SMS
- **验证码**：手机号验证码发送
- **状态跟踪**：短信发送状态监控

## 🔧 技术栈总结

### 后端技术
- **运行环境**：Node.js 16.13
- **部署平台**：腾讯云CloudBase
- **数据库**：MongoDB + Redis + MySQL
- **认证**：JWT
- **AI服务**：Kimi AI + OpenAI

### 前端技术
- **微信小程序**：原生小程序开发
- **Web管理端**：HTML5 + CSS3 + JavaScript
- **响应式设计**：移动端和桌面端适配

### 开发工具
- **版本控制**：Git
- **包管理**：npm
- **部署工具**：CloudBase CLI
- **测试工具**：Jest + curl

## 📈 系统特点

### 1. 高可用性
- ✅ 多AI服务提供商备份
- ✅ 数据库连接池管理
- ✅ 错误处理和重试机制

### 2. 可扩展性
- ✅ 模块化架构设计
- ✅ 服务层抽象
- ✅ 插件化扩展

### 3. 安全性
- ✅ JWT身份认证
- ✅ 输入验证和过滤
- ✅ 权限控制

### 4. 性能优化
- ✅ 数据库索引优化
- ✅ 缓存机制
- ✅ 异步处理

## 🎉 总结

OfferCome智能求职辅导平台采用现代化的微服务架构，具备：

1. **完整的功能覆盖**：从用户认证到AI服务，从MBTI测试到RAG文档管理
2. **灵活的分组管理**：支持按学生、模块、组合的精确分组
3. **高可靠性**：多服务提供商备份，完善的错误处理
4. **良好的扩展性**：模块化设计，易于功能扩展
5. **优秀的用户体验**：响应式设计，多端适配

这个架构图完整展示了系统的各个层次和组件关系，为系统的维护和扩展提供了清晰的指导。 