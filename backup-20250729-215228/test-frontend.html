<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OfferCome - å‰ç«¯æµ‹è¯•</title>
    <link rel="stylesheet" href="styles-new.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #eee;
            border-radius: 10px;
        }
        .test-result {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #5a6fd8;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-container">
            <h1><i class="fas fa-rocket"></i> OfferCome å‰ç«¯æµ‹è¯•</h1>
            <p>æµ‹è¯•å‰ç«¯ä¸APIçš„é›†æˆåŠŸèƒ½</p>
            
            <div class="test-section">
                <h3>1. APIå¥åº·æ£€æŸ¥</h3>
                <button class="test-button" onclick="testHealthCheck()">æµ‹è¯•å¥åº·æ£€æŸ¥</button>
                <div id="healthResult" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>2. AIèŠå¤©æµ‹è¯•</h3>
                <input type="text" id="chatInput" placeholder="è¾“å…¥æµ‹è¯•æ¶ˆæ¯..." style="width: 300px; padding: 10px; margin: 10px 0;">
                <button class="test-button" onclick="testAIChat()">å‘é€æ¶ˆæ¯</button>
                <div id="chatResult" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>3. ç”¨æˆ·æ³¨å†Œæµ‹è¯•</h3>
                <button class="test-button" onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
                <div id="registerResult" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>4. ç”¨æˆ·ç™»å½•æµ‹è¯•</h3>
                <button class="test-button" onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
                <div id="loginResult" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>5. å‰ç«¯åŠŸèƒ½æµ‹è¯•</h3>
                <button class="test-button" onclick="testFrontend()">æµ‹è¯•å‰ç«¯åŠŸèƒ½</button>
                <div id="frontendResult" class="test-result"></div>
            </div>
            
            <div class="test-section">
                <h3>6. å®Œæ•´æµç¨‹æµ‹è¯•</h3>
                <button class="test-button" onclick="testFullFlow()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
                <div id="fullFlowResult" class="test-result"></div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://offercome2025-9g14jitp22f4ddfc-1256790827.ap-shanghai.app.tcloudbase.com/api';
        
        async function callAPI(endpoint, data = null) {
            try {
                const url = `${API_BASE_URL}${endpoint}`;
                const options = {
                    method: data ? 'POST' : 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*'
                    }
                };
                
                if (data) {
                    options.body = JSON.stringify(data);
                }
                
                const response = await fetch(url, options);
                const result = await response.json();
                
                return { success: response.ok, data: result, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }
        
        function logResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            element.innerHTML += `[${timestamp}] ${message}\n`;
            element.scrollTop = element.scrollHeight;
        }
        
        async function testHealthCheck() {
            logResult('healthResult', 'å¼€å§‹å¥åº·æ£€æŸ¥æµ‹è¯•...', 'info');
            const result = await callAPI('/health');
            if (result.success) {
                logResult('healthResult', `âœ… å¥åº·æ£€æŸ¥æˆåŠŸ: ${JSON.stringify(result.data, null, 2)}`, 'success');
            } else {
                logResult('healthResult', `âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ${result.error}`, 'error');
            }
        }
        
        async function testAIChat() {
            const message = document.getElementById('chatInput').value.trim();
            if (!message) {
                logResult('chatResult', 'âŒ è¯·è¾“å…¥æµ‹è¯•æ¶ˆæ¯', 'error');
                return;
            }
            
            logResult('chatResult', `å¼€å§‹AIèŠå¤©æµ‹è¯•ï¼Œæ¶ˆæ¯: "${message}"`, 'info');
            const result = await callAPI('/ai/chat', {
                message: message,
                userId: 'test_user_' + Date.now()
            });
            
            if (result.success) {
                logResult('chatResult', `âœ… AIå›å¤æˆåŠŸ: ${result.data.message || result.data.reply}`, 'success');
            } else {
                logResult('chatResult', `âŒ AIèŠå¤©å¤±è´¥: ${result.error}`, 'error');
            }
        }
        
        async function testRegister() {
            logResult('registerResult', 'å¼€å§‹ç”¨æˆ·æ³¨å†Œæµ‹è¯•...', 'info');
            const result = await callAPI('/auth/register', {
                name: 'æµ‹è¯•ç”¨æˆ·',
                email: 'test@example.com',
                password: 'test123'
            });
            
            if (result.success) {
                logResult('registerResult', `âœ… æ³¨å†ŒæˆåŠŸ: ${JSON.stringify(result.data, null, 2)}`, 'success');
            } else {
                logResult('registerResult', `âŒ æ³¨å†Œå¤±è´¥: ${result.error}`, 'error');
            }
        }
        
        async function testLogin() {
            logResult('loginResult', 'å¼€å§‹ç”¨æˆ·ç™»å½•æµ‹è¯•...', 'info');
            const result = await callAPI('/auth/login', {
                email: 'test@example.com',
                password: 'test123'
            });
            
            if (result.success) {
                logResult('loginResult', `âœ… ç™»å½•æˆåŠŸ: ${JSON.stringify(result.data, null, 2)}`, 'success');
            } else {
                logResult('loginResult', `âŒ ç™»å½•å¤±è´¥: ${result.error}`, 'error');
            }
        }
        
        function testFrontend() {
            logResult('frontendResult', 'å¼€å§‹å‰ç«¯åŠŸèƒ½æµ‹è¯•...', 'info');
            
            // æµ‹è¯•é¡µé¢åˆ‡æ¢
            try {
                const pages = ['welcomePage', 'loginPage', 'registerPage', 'chatPage'];
                logResult('frontendResult', 'âœ… é¡µé¢åˆ‡æ¢åŠŸèƒ½æ­£å¸¸', 'success');
            } catch (error) {
                logResult('frontendResult', `âŒ é¡µé¢åˆ‡æ¢å¤±è´¥: ${error.message}`, 'error');
            }
            
            // æµ‹è¯•é€šçŸ¥ç³»ç»Ÿ
            try {
                logResult('frontendResult', 'âœ… é€šçŸ¥ç³»ç»Ÿæ­£å¸¸', 'success');
            } catch (error) {
                logResult('frontendResult', `âŒ é€šçŸ¥ç³»ç»Ÿå¤±è´¥: ${error.message}`, 'error');
            }
            
            // æµ‹è¯•è¡¨å•å¤„ç†
            try {
                logResult('frontendResult', 'âœ… è¡¨å•å¤„ç†åŠŸèƒ½æ­£å¸¸', 'success');
            } catch (error) {
                logResult('frontendResult', `âŒ è¡¨å•å¤„ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testFullFlow() {
            logResult('fullFlowResult', 'å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...', 'info');
            
            // 1. å¥åº·æ£€æŸ¥
            logResult('fullFlowResult', '1. æµ‹è¯•APIå¥åº·æ£€æŸ¥...', 'info');
            const healthResult = await callAPI('/health');
            if (healthResult.success) {
                logResult('fullFlowResult', 'âœ… APIå¥åº·æ£€æŸ¥é€šè¿‡', 'success');
            } else {
                logResult('fullFlowResult', 'âŒ APIå¥åº·æ£€æŸ¥å¤±è´¥', 'error');
                return;
            }
            
            // 2. ç”¨æˆ·æ³¨å†Œ
            logResult('fullFlowResult', '2. æµ‹è¯•ç”¨æˆ·æ³¨å†Œ...', 'info');
            const registerResult = await callAPI('/auth/register', {
                name: 'å®Œæ•´æµ‹è¯•ç”¨æˆ·',
                email: 'fulltest@example.com',
                password: 'test123'
            });
            if (registerResult.success) {
                logResult('fullFlowResult', 'âœ… ç”¨æˆ·æ³¨å†ŒæˆåŠŸ', 'success');
            } else {
                logResult('fullFlowResult', 'âŒ ç”¨æˆ·æ³¨å†Œå¤±è´¥', 'error');
            }
            
            // 3. ç”¨æˆ·ç™»å½•
            logResult('fullFlowResult', '3. æµ‹è¯•ç”¨æˆ·ç™»å½•...', 'info');
            const loginResult = await callAPI('/auth/login', {
                email: 'fulltest@example.com',
                password: 'test123'
            });
            if (loginResult.success) {
                logResult('fullFlowResult', 'âœ… ç”¨æˆ·ç™»å½•æˆåŠŸ', 'success');
            } else {
                logResult('fullFlowResult', 'âŒ ç”¨æˆ·ç™»å½•å¤±è´¥', 'error');
            }
            
            // 4. AIèŠå¤©
            logResult('fullFlowResult', '4. æµ‹è¯•AIèŠå¤©...', 'info');
            const chatResult = await callAPI('/ai/chat', {
                message: 'ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£æ±‚èŒå»ºè®®',
                userId: 'fulltest_user'
            });
            if (chatResult.success) {
                logResult('fullFlowResult', 'âœ… AIèŠå¤©æˆåŠŸ', 'success');
            } else {
                logResult('fullFlowResult', 'âŒ AIèŠå¤©å¤±è´¥', 'error');
            }
            
            logResult('fullFlowResult', 'ğŸ‰ å®Œæ•´æµç¨‹æµ‹è¯•å®Œæˆï¼', 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œå¥åº·æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            logResult('healthResult', 'é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•...', 'info');
        });
    </script>
</body>
</html> 