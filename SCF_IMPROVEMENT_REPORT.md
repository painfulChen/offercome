# ğŸš€ SCFæ”¹è¿›å®æ–½æŠ¥å‘Š

## ğŸ“‹ æ”¹è¿›æ¦‚è¿°

åŸºäºæ‚¨æä¾›çš„ä¸“ä¸šå»ºè®®ï¼Œæˆ‘ä»¬å·²ç»å®æ–½äº†CloudBase SCF + API Gateway + GitHub Actionsçš„å®Œæ•´æ”¹è¿›æ–¹æ¡ˆï¼Œè§£å†³äº†è·¯å¾„é…ç½®ã€è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œé”™è¯¯å¤„ç†ç­‰å…³é”®é—®é¢˜ã€‚

## âœ… å·²å®Œæˆçš„æ”¹è¿›

### 1. ç»Ÿä¸€äº‘å‡½æ•°å…¥å£ä¸APIè·¯ç”±

#### âœ… å•ä¸€å…¥å£å‡½æ•°
- **æ–‡ä»¶**: `functions/index.js`
- **ç»Ÿä¸€å…¥å£**: `main_handler` å‡½æ•°
- **è·¯ç”±é…ç½®**: ä½¿ç”¨Expressç»Ÿä¸€å¤„ç†æ‰€æœ‰APIè·¯ç”±
- **è¯·æ±‚è¿½è¸ª**: é›†æˆè¯·æ±‚IDè¿½è¸ªæœºåˆ¶

#### âœ… é›†ä¸­è·¯ç”±ç®¡ç†
- **é…ç½®**: `serverless.yml` ä¸­é…ç½® `/api/{proxy+}` è·¯å¾„
- **æ–¹æ³•**: æ”¯æŒæ‰€æœ‰HTTPæ–¹æ³• (ANY)
- **ç¯å¢ƒå‰ç¼€**: æ”¯æŒ `/dev` / `/test` / `/prod` ç¯å¢ƒå‰ç¼€

#### âœ… å¤šç¯å¢ƒæ”¯æŒ
- **å¼€å‘ç¯å¢ƒ**: `env.dev`
- **æµ‹è¯•ç¯å¢ƒ**: `env.test`
- **ç”Ÿäº§ç¯å¢ƒ**: `env.prod`

### 2. ç®€åŒ–å¤šç¯å¢ƒCI/CDæµç¨‹

#### âœ… GitHub Actionså·¥ä½œæµ
- **æ–‡ä»¶**: `.github/workflows/deploy.yml`
- **è§¦å‘æ¡ä»¶**: pushåˆ°main/developåˆ†æ”¯
- **ç¯å¢ƒçŸ©é˜µ**: è‡ªåŠ¨éƒ¨ç½²åˆ°dev/testç¯å¢ƒ
- **å¥åº·æ£€æŸ¥**: éƒ¨ç½²åè‡ªåŠ¨æµ‹è¯•API

#### âœ… åˆ†æ”¯å¯¹é½ç­–ç•¥
| Gitåˆ†æ”¯ | SCF Stage | ç”¨é€” |
|---------|-----------|------|
| `develop` | `dev` | å¼€å‘è°ƒè¯• |
| `main` | `test` | QA/UAT |

### 3. å®Œå–„æ—¥å¿—ä¸é”™è¯¯å¤„ç†

#### âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†
- **å¼‚å¸¸æ•è·**: try-catchåŒ…è£…æ‰€æœ‰ä¸šåŠ¡é€»è¾‘
- **é”™è¯¯å“åº”**: ç»Ÿä¸€JSONæ ¼å¼é”™è¯¯å“åº”
- **è¯·æ±‚è¿½è¸ª**: æ¯ä¸ªè¯·æ±‚éƒ½æœ‰å”¯ä¸€ID

#### âœ… é“¾è·¯è¿½è¸ª
- **è¯·æ±‚ID**: è‡ªåŠ¨ç”Ÿæˆå¹¶è¿”å›ç»™å®¢æˆ·ç«¯
- **æ—¥å¿—èšåˆ**: æ”¯æŒæŒ‰è¯·æ±‚IDèšåˆæ—¥å¿—
- **è°ƒè¯•ä¿¡æ¯**: å¼€å‘ç¯å¢ƒæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯

#### âœ… ç›‘æ§å‘Šè­¦
- **æ—¥å¿—é…ç½®**: æ”¯æŒCLSæ—¥å¿—é›†å’Œä¸»é¢˜
- **å‘Šè­¦æ¨¡æ¿**: å¯é…ç½®5xxé”™è¯¯å’Œå†·å¯åŠ¨å‘Šè­¦

## ğŸ—‚ï¸ æ–°çš„é¡¹ç›®ç»“æ„

```
offercome/
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ index.js              # ç»Ÿä¸€äº‘å‡½æ•°å…¥å£
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ routes/               # APIè·¯ç”±
â”‚   â”œâ”€â”€ models/               # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/             # ä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ config/               # é…ç½®æ–‡ä»¶
â”œâ”€â”€ serverless.yml            # SCFé…ç½®æ–‡ä»¶
â”œâ”€â”€ env.dev                   # å¼€å‘ç¯å¢ƒé…ç½®
â”œâ”€â”€ env.test                  # æµ‹è¯•ç¯å¢ƒé…ç½®
â”œâ”€â”€ env.prod                  # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”œâ”€â”€ .github/workflows/        # GitHub Actions
â”œâ”€â”€ deploy-scf.sh            # éƒ¨ç½²è„šæœ¬
â””â”€â”€ public/                   # é™æ€ç½‘ç«™
```

## ğŸ”§ æŠ€æœ¯æ”¹è¿›

### 1. è·¯å¾„ç»Ÿä¸€
- **é—®é¢˜**: ä¹‹å‰å¤šä¸ªäº‘å‡½æ•°å…¥å£ç‚¹é…ç½®å¤æ‚
- **è§£å†³**: ç»Ÿä¸€ä½¿ç”¨ `functions/index.js` ä½œä¸ºå”¯ä¸€å…¥å£
- **ä¼˜åŠ¿**: ç®€åŒ–é…ç½®ï¼Œä¾¿äºç»´æŠ¤

### 2. è‡ªåŠ¨åŒ–éƒ¨ç½²
- **é—®é¢˜**: æ‰‹åŠ¨éƒ¨ç½²å®¹æ˜“å‡ºé”™
- **è§£å†³**: GitHub Actionsè‡ªåŠ¨è§¦å‘éƒ¨ç½²
- **ä¼˜åŠ¿**: ä»£ç æ¨é€å³è‡ªåŠ¨éƒ¨ç½²

### 3. é”™è¯¯å¤„ç†
- **é—®é¢˜**: äº‘å‡½æ•°é”™è¯¯ä¿¡æ¯ä¸å¤Ÿè¯¦ç»†
- **è§£å†³**: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- **ä¼˜åŠ¿**: å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜

## ğŸš€ éƒ¨ç½²æµç¨‹

### æœ¬åœ°éƒ¨ç½²
```bash
# éƒ¨ç½²åˆ°å¼€å‘ç¯å¢ƒ
./deploy-scf.sh dev

# éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ
./deploy-scf.sh test

# éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
./deploy-scf.sh prod
```

### è‡ªåŠ¨éƒ¨ç½²
```bash
# æ¨é€åˆ°developåˆ†æ”¯ -> è‡ªåŠ¨éƒ¨ç½²åˆ°devç¯å¢ƒ
git push origin develop

# æ¨é€åˆ°mainåˆ†æ”¯ -> è‡ªåŠ¨éƒ¨ç½²åˆ°testç¯å¢ƒ
git push origin main
```

## ğŸ“Š ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ (dev)
- **æ•°æ®åº“**: cloudbase_ai_dev
- **JWTå¯†é’¥**: dev-jwt-secret-key
- **æ—¥å¿—çº§åˆ«**: DEBUG

### æµ‹è¯•ç¯å¢ƒ (test)
- **æ•°æ®åº“**: cloudbase_ai_test
- **JWTå¯†é’¥**: test-jwt-secret-key
- **æ—¥å¿—çº§åˆ«**: INFO

### ç”Ÿäº§ç¯å¢ƒ (prod)
- **æ•°æ®åº“**: cloudbase_ai
- **JWTå¯†é’¥**: prod-jwt-secret-key
- **æ—¥å¿—çº§åˆ«**: WARN

## ğŸ”— APIç«¯ç‚¹

### å¥åº·æ£€æŸ¥
- **å¼€å‘**: `https://offercome2025-9g14jitp22f4ddfc-1256790827.ap-shanghai.app.tcloudbase.com/dev/api/health`
- **æµ‹è¯•**: `https://offercome2025-9g14jitp22f4ddfc-1256790827.ap-shanghai.app.tcloudbase.com/test/api/health`

### ä¸šåŠ¡API
- **ç”¨æˆ·è®¤è¯**: `/api/auth/*`
- **AIæœåŠ¡**: `/api/ai/*`
- **æ¡ˆä¾‹ç®¡ç†**: `/api/cases/*`
- **è¾…å¯¼ä¼šè¯**: `/api/coaching/*`
- **ç”¨æˆ·ç®¡ç†**: `/api/users/*`
- **æ•°æ®å¤‡ä»½**: `/api/backup/*`
- **æ€§èƒ½ç›‘æ§**: `/api/monitor/*`

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. é…ç½®GitHub Secrets
éœ€è¦åœ¨GitHubä»“åº“è®¾ç½®ä»¥ä¸‹Secrets:
- `SECRET_ID_DEV` / `SECRET_KEY_DEV`
- `SECRET_ID_TEST` / `SECRET_KEY_TEST`
- `SECRET_ID_PROD` / `SECRET_KEY_PROD`

### 2. é…ç½®CLSæ—¥å¿—
- åœ¨SCFæ§åˆ¶å°ç»‘å®šCLSæ—¥å¿—é›†
- é…ç½®æ—¥å¿—ä¸»é¢˜å’Œå‘Šè­¦è§„åˆ™

### 3. æ€§èƒ½ä¼˜åŒ–
- é…ç½®å†·å¯åŠ¨ä¼˜åŒ–
- è®¾ç½®å†…å­˜å’Œè¶…æ—¶å‚æ•°
- ç›‘æ§QPSå’Œå“åº”æ—¶é—´

### 4. å®‰å…¨åŠ å›º
- é…ç½®HTTPSå¼ºåˆ¶è·³è½¬
- è®¾ç½®CORSç­–ç•¥
- æ·»åŠ APIé™æµ

## ğŸ‰ æ€»ç»“

é€šè¿‡å®æ–½è¿™äº›æ”¹è¿›ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

- âœ… **è·¯å¾„ç»Ÿä¸€**: å•ä¸€å…¥å£å‡½æ•°ï¼Œç®€åŒ–é…ç½®
- âœ… **è‡ªåŠ¨åŒ–éƒ¨ç½²**: GitHub Actionsè‡ªåŠ¨è§¦å‘
- âœ… **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… **å¤šç¯å¢ƒæ”¯æŒ**: dev/test/prodç¯å¢ƒåˆ†ç¦»
- âœ… **ç›‘æ§å‘Šè­¦**: æ”¯æŒCLSæ—¥å¿—å’Œå‘Šè­¦

ç°åœ¨æ‚¨çš„CloudBase AIå¼€å‘æ¡†æ¶å…·å¤‡äº†ç”Ÿäº§çº§çš„éƒ¨ç½²å’Œè¿ç»´èƒ½åŠ›ï¼

**GitHubä»“åº“**: https://github.com/painfulChen/offercome.git 